{% extends "layout" %}

{% block page %}
  <h1>Agents</h1>

  {% include "filter" %}

  <style>

    .agent-card {
      width: 200px;
      border-radius: 12px;
      padding: 16px;
      text-align: center;
      margin-bottom: 8px;
      color: #fff;
      font-weight: bold;
      border: 1.5px solid #e0e0e0;
      border-bottom: 4px solid #bdbdbd;
      box-shadow: 0 4px 16px rgba(0,0,0,0.10), 0 1.5px 4px rgba(0,0,0,0.08);
      transition: transform 0.1s;
    }
    .agent-online {
      background: #2d9b52;
    }
    .agent-offline {
      background: #b52d2d;
    }
    .agent-card:hover {
      transform: translateY(-4px) scale(1.03);
    }
    .agents-list {
      background-color: rgb(240, 240, 240);
      padding: 40px;
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      cursor: pointer;
    }
    .agents-list a {
      color: inherit;
      text-decoration: none;
    }
    .agent-host-info {
      font-size: 0.9em;
      color: #ebebeb;
    }
    .agent-online-info {
      font-size: 0.9em;
      color: #cccccc;
    }
  </style>

  <br>
  <a href="#" class="btn" onclick="window.location.href = '/agents/add'; return false;">Add Agent</a>
  <a href="#" class="btn" onclick="window.location.href = '/agents/delete'; return false;">Delete Displayed</a>

  <input type="radio" id="all_filter" name="agent_status_filter" value="-1" checked>
  <label for="all_filter">All</label>
  <input type="radio" id="offline_filter" name="agent_status_filter" value="0">
  <label for="offline_filter">Offline</label>
  <input type="radio" id="online_filter" name="agent_status_filter" value="1">
  <label for="online_filter">Online</label>
  <br><br>

  <div class="agents-list">
    {% if not items %}
      <div class="agent-card">No agents found</div>
    {% endif %}

    {% set items = items | sort(attribute='name') %}
    {% for item in items %}
      <div class="agent-card {% if item.status == 1 %}agent-online{% else %}agent-offline{% endif %}">
        {{ item.name }}<br>
        <img width="100px;" src="/agent.png"><br>
        <span class="agent-host-info">{{ item.hostname}}:{{ item.port}}</span><br>
        <div class="agent-online-info">
          Last Ping: <span class="utc-date" data-timestamp="{{ item.last_ping['$date']['$numberLong'] }}">{{ item.last_ping['$date']['$numberLong'] }}</span><br><br>
          {% if item.status == 1 %}
            Online
          {% else %}
            Offline
          {% endif %}
        </div>
      </div>
    {% endfor %}
  </div>

  {% include "pagination" %}
 
{% endblock %}