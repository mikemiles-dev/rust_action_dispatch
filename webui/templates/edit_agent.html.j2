{% extends "layout" %}

{% block page %}
  <h1>{{ page_name }}</h1>

<br>
{% if error and error != "" %}
    <span class="error">{{ error }}</span>
    <br><br><br>
    <a href="javascript:history.back()" class="btn btn-secondary">Back</a>
{% else %}

    <form id="edit-agent-form" method="post" action="/agents">
        <input type="hidden" name="id" value="{{ agent_id }}">
        <div class="form-group">
            <label class="form-label" for="name">Name</label>
            <input type="text" id="name" name="name" class="form-control" value="{{ agent.name }}">
        </div>
        <div class="form-group">
            <label class="form-label" for="hostname">Hostname</label>
            <input type="text" id="hostname" name="hostname" class="form-control" value="{{ agent.hostname }}">
        </div>
        <div class="form-group">
            <label class="form-label" for="port">Port</label>
            <input type="number" id="port" name="port" class="form-control" value="{{ agent.port }}">
        </div>
        <a href="#" class="btn btn-secondary" onclick="submitAndStay(event)">Save</a>
        <a href="#" class="btn btn-secondary">Delete</a>
        <a href="javascript:history.back()" class="btn btn-secondary">Back</a>
    </form>

        <br><br>
        {% include "edit_status" %}

    </form>
    <script>
    function submitAndStay(event) {
        event.preventDefault();
        const form = document.getElementById('edit-agent-form');
        const formData = new FormData(form);
        fetch(form.action, {
            method: form.method,
            body: formData,
        })
        .then(response => response.text())
        .then(data => {
            const statusError = document.getElementById('status-error');
            statusError.style.display = 'none'; // Hide any previous error
            const statusSuccess = document.getElementById('status-success');
            statusSuccess.innerHTML = data;
            statusSuccess.style.display = 'block';
            // Optionally update part of the page or show a message
            // For example, reload the status include:
            //location.reload(); // Or handle more gracefully if needed
        })
        .catch(error => {
            alert(error);
            const statusSuccess = document.getElementById('status-success');
            statusSuccess.style.display = 'none'; // Hide any previous success
            const statusError = document.getElementById('status-error');
            statusError.innerHTML = error;
            statusError.style.display = 'block';

        });
    }
    </script>

{% endif %}

 
{% endblock %}