{% extends "layout" %}

{% block page %}
  <h1>Runs</h1>

  <div style="float: left">
    <input onchange="applyFilterAndReload('filter', this.value, false, true); return false" class="search" name="search" value="{{ filter }}" autofocus>
  </div>

  <div style="float: right;">
    <div style="float: left; width: 50px; padding: 5px;">
      <b>To:</b><br>
      <b>From:</b>
    </div>
    <div style="float: left; width: 220px">
     <input id="range_start" type="datetime-local"><br>
     <input id="range_end" type="datetime-local">
    </div>
    <div style="float: left">
      <button class="btn" onclick="applyFilterAndReload('filter', document.querySelector('input[name=search]').value, true, true); return false;">Apply</button>
      <button class="btn" onclick="window.location.href = window.location.pathname; return false;">Clear</button>
    </div>
  </div>
  
  <table>
    <thead>
      <tr>
      {% set columns = [
        ('agent_name', 'Agent Name'),
        ('job_name', 'Job Name'),
        ('started_at', 'Started At'),
        ('completed_at', 'Completed At'),
        ('return_code', 'Return Code')
      ] %}
      {% for col, label in columns %}
        <th {% if sort == col %}style="background-color: #999999"{% endif %}>
        <a href="#" onclick="applyFilterAndReload('sort', '{{ col }}', true); return false;">
          {{ label }}
        </a>
        </th>
      {% endfor %}
      </tr>
    </thead>
    <tbody>
      {% for item in items %}
        <tr>
          <td>{{ item.agent_name }}</td>
          <td>{{ item.job_name }}</td>
          <td class="utc-date" data-timestamp="{{ item.started_at['$date']['$numberLong'] }}">{{ item.started_at['$date']['$numberLong'] }}</td>
          <td class="utc-date" data-timestamp="{{ item.completed_at['$date']['$numberLong'] }}">{{ item.completed_at['$date']['$numberLong'] }}</td>
          <td>{{ item.return_code }}</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>

  {% include "pagination" %}
 
{% endblock %}